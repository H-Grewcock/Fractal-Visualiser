<!-- 3DFractals.html -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Polyhedra IFS & Chaos Game</title>
  <link rel="stylesheet" href="css/styles.css" />

  <style>
    #nav-container, #footer-container { width: 100%; }

    /* Main container with canvas and side panel */
    #mainContent {
      display: flex;
      height: calc(100vh - 120px); /* adjusted for nav & footer approx. height */
      box-sizing: border-box;
      overflow: hidden;
    }

    /* Side panel on the right */
    #sidePanel {
      width: 320px;
      padding: 20px;
      background: #f9f9f9;
      border-left: 1px solid #ddd;
      overflow-y: auto;
      box-sizing: border-box;
    }

    /* Canvas container takes the remaining space */
    #canvasContainer {
      flex: 1;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white; /* white background */
    }

    #canvas3D {
      border: 1px solid #ccc; /* just so you see it */
      max-width: 100%;
      max-height: 100%;
      display: block;
    }

    #zoom-indicator, #mouse-coords {
      position: fixed;
      right: 10px;
      color: #333;
      font-family: monospace;
      background: rgba(255,255,255,0.8);
      padding: 3px 6px;
      border-radius: 4px;
      user-select: none;
      pointer-events: none;
      font-size: 13px;
      z-index: 1000;
    }
    #zoom-indicator { bottom: 10px; }
    #mouse-coords { bottom: 30px; }

    /* Controls styling */
    #sidePanel label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      font-size: 14px;
      color: #333;
    }

    #sidePanel select, #sidePanel button, #sidePanel input[type="number"], #sidePanel input[type="range"] {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      box-sizing: border-box;
      font-size: 15px;
      border-radius: 4px;
      border: 1px solid #aaa;
    }

    #sidePanel select, #sidePanel button {
      cursor: pointer;
      background: #4e6350;
      color: white;
      transition: background-color 0.3s ease;
    }
    #sidePanel select:hover, #sidePanel button:hover:not(:disabled) { background: #3d4e3d; }
    #sidePanel button:disabled { background: #888; cursor: not-allowed; }

    .small-note { font-size: 12px; color: #555; margin-top: 6px; }
    .inline-value { font-family: monospace; padding-left: 6px; }
  </style>
</head>

<body>
  <!-- Navbar placeholder -->
  <div id="nav-container" role="navigation" aria-label="Primary navigation"></div>

  <!-- Main content -->
  <div id="mainContent">
    <div id="canvasContainer">
      <!-- ID must be canvas3D to match JS -->
      <canvas id="polyCanvas" width="600" height="600" aria-label="Polyhedra IFS & chaos game visualisation"></canvas>
      <div id="zoom-indicator" aria-live="polite" aria-atomic="true">Zoom: 1.00x</div>
      <div id="mouse-coords" aria-live="polite" aria-atomic="true">X: 0.00, Y: 0.00</div>
    </div>

    <div id="sidePanel" role="region" aria-label="Polyhedra IFS & chaos game controls">
      <h2>Polyhedra IFS & Chaos Game</h2>

      <div id="controls">
        <label for="fractalExample">Select:</label>
        <select id="fractalExample" name="fractalExample">
          <!-- Polyhedra IFS -->
          <optgroup label="Polyhedra IFS">
            <option value="poly_tetra_vertices">Tetra – Vertices</option>
            <option value="poly_octa_faces">Octa – Face Centers</option>
            <option value="poly_cube_edges">Cube – Edge Midpoints</option>
            <option value="poly_icosa_vertices_nr">Icosa – Vertices (no-repeat)</option>
          </optgroup>

          <!-- Symmetry Orbits -->
          <optgroup label="Symmetry Orbits">
            <option value="orbit_tetra">Tetra – Symmetry Orbit</option>
            <option value="orbit_icosa">Icosa – Symmetry Orbit</option>
          </optgroup>

          <!-- Generic Chaos Game example -->
          <optgroup label="Chaos Game">
            <option value="chaos_cube_vertices">Chaos Game – Cube Vertices</option>
          </optgroup>
        </select>
      </div>

      <!-- Iterations -->
      <label for="iterationsInput">Iterations:</label>
      <input type="number" id="iterationsInput" name="iterationsInput" min="1" max="100" step="1" value="20" />
      <button id="iterationsBtn">Set Iterations</button>

      <!-- Lambda (for IFS / chaos game) -->
      <label for="lambdaInput">λ (jump fraction): <span class="inline-value" id="lambdaOut">0.50</span></label>
      <input type="range" id="lambdaInput" name="lambdaInput" min="0.1" max="0.9" step="0.01" value="0.5" />
      <div class="small-note">Used by Polyhedra IFS and Chaos Game. 0.5 is classic Sierpiński-like; try 0.55–0.65 too.</div>

      <!-- Rotation speed -->
      <label for="rotationSpeed">Rotation Speed (degrees/s):</label>
      <input type="number" id="rotationSpeed" name="rotationSpeed" min="0" max="360" step="1" value="30" />

      <!-- Zoom -->
      <label for="zoomLevel">Zoom Level:</label>
      <input type="number" id="zoomLevel" name="zoomLevel" min="0.1" max="10" step="0.1" value="1" />

      <!-- Colour scheme -->
      <label for="colorScheme">Colour Scheme:</label>
      <select id="colorScheme" name="colorScheme">
        <option value="classic">Classic</option>
        <option value="fire">Fire</option>
        <option value="ice">Ice</option>
        <option value="neon">Neon</option>
      </select>

      <button id="renderBtn">Render</button>
      <button id="resetViewBtn">Reset View</button>
      <button id="exportImageBtn">Export Image</button>
      <button id="toggleAnimationBtn">Toggle Animation</button>
      <button id="startRecordingBtn">Start Recording</button>
      <button id="stopRecordingBtn" disabled>Stop Recording</button>
    </div>
  </div>

  <!-- Footer placeholder-->
  <div id="footer-container" role="contentinfo"></div>

  <script>
    async function loadComponent(id, url) {
      {
  const container = document.getElementById(id);
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`Failed to load ${url}: ${response.statusText}`);
    const html = await response.text();
    container.innerHTML = html;
    if (id === "nav-container") initNavToggle();
  } catch (error) {
    console.error(error);
    container.innerHTML = `<p style="color:red;">Could not load content.</p>`;
  }
}

    }

    function initNavToggle() {
      const menuToggle = document.getElementById("menuToggle");
      const navLinks = document.getElementById("navLinks");
      const menuIcon = document.getElementById("menuIcon");
      if (!menuToggle || !navLinks || !menuIcon) return;

      menuToggle.setAttribute("aria-expanded", "false");
      menuToggle.setAttribute("aria-controls", "navLinks");

      menuToggle.addEventListener("click", () => {
        const isVisible = navLinks.classList.toggle("visible");
        menuIcon.innerHTML = isVisible ? "&times;" : "&#9776;";
        menuToggle.setAttribute("aria-expanded", isVisible.toString());
      });

      document.addEventListener("click", (event) => {
        const nav = document.querySelector(".nav");
        if (nav && !nav.contains(event.target)) {
          navLinks.classList.remove("visible");
          menuIcon.innerHTML = "&#9776;";
          menuToggle.setAttribute("aria-expanded", "false");
          menuToggle.focus();
        }
      });
    }

    loadComponent('nav-container', 'components/nav.html');
    loadComponent('footer-container', 'components/footer.html');

    // mirror lambda value next to the slider
    document.addEventListener('DOMContentLoaded', () => {
      const lambdaInput = document.getElementById('lambdaInput');
      const lambdaOut = document.getElementById('lambdaOut');
      if (lambdaInput && lambdaOut) {
        const sync = () => { lambdaOut.textContent = parseFloat(lambdaInput.value).toFixed(2); };
        lambdaInput.addEventListener('input', sync);
        sync();
      }
    });
  </script>

  <script src="js/polyIFS.js"></script>
</body>
</html>